<?require_once("shared_inc/language.inc.php");$user_lang = read_language();$article = $_REQUEST['article']; $articleenc = name_in_url($article);$needle = $_REQUEST['needle']; $lang = $_REQUEST['lang'];if($lang==""){	$lang=$user_lang; }$project = $_REQUEST['project'];if($project==""){	$project="wikipedia";}$limit = $_REQUEST['limit'];if($limit==""){	$limit = 50;}function removeheaders($buf) {	preg_match ("/\r\n\r\n(.*)$/is",$buf,$hit);	return $hit[1];}function get_request($server,$page,$ignore_redir=false) {	set_time_limit(120);	//echo $server.$page;	$fp = fsockopen ($server, 80, $errno, $errstr, 3);	if (!$fp) {			echo "Problem beim Zugriff auf ";			echo "<a href=\"".$server.$page."\">".$server.$page."</a>:\n";			echo "Fehler $errno -  $errstr<br />\n";	} else {	$http_command = "GET $page HTTP/1.0 \nHost: $server \nCookie: $cookies\nUser-Agent: ".USERAGENT."\r\n\r\n";	$http_command = "GET $page HTTP/1.0\nUser-Agent: ".USERAGENT."\r\n\r\n";	//echo $http_command;		fputs ($fp,$http_command);		while (!feof($fp)) {			$buf.= fgets($fp,128);		}		fclose($fp);		//$buf2=getheaders($buf);		//preg_match('@Location: http://(.*)/(.*)\r\n@iU',$buf2,$hit);		if($hit[1]!="" && (!$ignore_redir)) {			$buf=get_request($hit[1],"/".$hit[2]);		}		flush();		return $buf;	}}function name_in_url ($name){	$name = str_replace(' ', '_', $name);	$name = urlencode($name);	return $name;}//fetches all versionsfunction get_history($server, $articleenc, $limit=50, $offset=""){	if($offset=="") 	{ 		$offset = strftime("%Y%m%d%H%M%S");	}		$historyurl = "http://".$server."/w/index.php?title=".$articleenc."&action=history&limit=$limit&offset=$offset";	return get_request($server, $historyurl);}function create_images($was_found){	if($was_found)	{		//$bild = imagecreatefrompng('shared_inc/ok.png');		$hoch = 15;		$breit = 25;		$bild = imagecreate($breit, $hoch);		$hg = imagecolorallocate($bild, 255,255,255);		imagefilledrectangle($bild, 1, 1, $breit, $hoch, $hg);		$font = 5;				$farbe = imagecolorallocate($bild, 0,255,0);		$meldung = "ok";	}	else	{		$hoch = 30;		$breit = 50;		$bild = imagecreate($breit, $hoch);		$hg = imagecolorallocate($bild, 255,255,255);		imagefilledrectangle($bild, 1, 1, $breit, $hoch, $hg);		$font = 5;		//$bild = imagecreatefrompng('shared_inc/no.png');		$farbe = imagecolorallocate($bild, 255, 0,0);		$meldung = "fehlt";	}		imagestring($bild, $font, 5, 5, $meldung, $farbe);	imagepng($bild);	imagedestroy($bild);	}function datedrop_with_months ($name, $varanf="", $intab=true, $jahranf="", $jahrbis="", $seljahr="", $selmon="", $seltag="", $the_months){	if($jahranf=="")		{		$jahranf = date("Y");	}		if($jahrbis=="")		{		$jahrbis = date("Y")+1;	}		if($seltag=="")	{		$seltag=date("dSSS");	}		if($selmon=="")	{		$selmon=date("m");	}		if($seljahr=="")	{		$seljahr=date("Y");	}		if($intab==true)	{		$headers = "<tr>\n";		$headers.="<td>\n";		$headers.="$name\n";		$headers.="</td>\n";		$headers.="<td>\n";		$trailers =  " </td>\n</tr>\n";	}			echo $headers;	dropdown ($varanf."tag", 1, 31, 1, "", "", $seltag);	array_drop ($varanf."mon", $the_months, 1, "", "", $the_months[($selmon-1)]);	dropdown ($varanf."jahr", $jahranf, $jahrbis, 1, "", "", $seljahr);	echo $trailers;	}/**@brief creates a select box with integers.e.g. for use in datum form fields@param $name name attribute of the form field@param $start integer to begin at@param $ende integer to end at@param $ruck step size@param $size size/length of the form field@param $onchange javascript function to run on change*/function dropdown ($name, $start, $ende, $ruck=0, $size="", $onchange="", $selected=""){	$vorne = "";	for($i=0;$i<$ruck;$i++)	{		$vorne = $vorne." ";	}		if($size!='')	{		echo $vorne."<select name=\"$name\" size=\"$size\"";	}	else	{		echo $vorne."<select name=\"$name\" ";	}		if($onchange!="")	{		echo " onchange=\"$onchange\"";	}		echo ">\n";		for($i=$start;$i<=$ende;$i++)	{		echo $vorne." <option value=\"$i\"";				if(($selected!="")&&($i==$selected))		{			echo " selected";		}		echo ">$i</option>\n";			}		echo $vorne."</select>\n";}/**@brief turns an array into a drop down field@param $name @param $werte array with values@param $size size/length of field@param $startwert additional start value*/function array_drop ($name, $werte, $size="", $startwert="", $onchange="", $selected=""){	$vorne = " ";		if($size!='')	{		echo $vorne."<select name=\"$name\" size=\"$size\"";	}	else	{		echo $vorne."<select name=\"$name\" ";	}				if($onchange!="")	{		echo " onchange=\"$onchange\"";	}		echo ">\n";	if($startwer!="")	{		echo $vorne." <option value=\"\">$startwert</option>\n";	}	for($i=0;$i<count($werte);$i++)	{		if($selected!="" && $werte[$i]==$selected)		{			echo $vorne." <option value=\"".($i+1)."\" selected>$werte[$i]</option>\n";		}		else		{			echo $vorne." <option value=\"".($i+1)."\">$werte[$i]</option>\n";		}	}	echo $vorne."</select>\n";	}?>