<?require_once("shared_inc/flometh.php");require_once("shared_inc/language.inc.php");$user_lang = read_language();$article = $_REQUEST['article']; $articleenc = name_in_url($article);$needle = $_REQUEST['needle']; $lang = $_REQUEST['lang'];if($lang==""){	$lang=$user_lang; }$project = $_REQUEST['project'];if($project==""){	$project="wikipedia";}$limit = $_REQUEST['limit'];if($limit==""){	$limit = 50;}function removeheaders($buf) {	preg_match ("/\r\n\r\n(.*)$/is",$buf,$hit);	return $hit[1];}function get_request($server,$page,$ignore_redir=false) {	set_time_limit(120);	//echo $server.$page;	$fp = fsockopen ($server, 80, $errno, $errstr, 3);	if (!$fp) {			echo "Problem beim Zugriff auf ";			echo "<a href=\"".$server.$page."\">".$server.$page."</a>:\n";			echo "Fehler $errno -  $errstr<br />\n";	} else {	$http_command = "GET $page HTTP/1.0 \nHost: $server \nCookie: $cookies\nUser-Agent: ".USERAGENT."\r\n\r\n";	$http_command = "GET $page HTTP/1.0\nUser-Agent: ".USERAGENT."\r\n\r\n";	//echo $http_command;		fputs ($fp,$http_command);		while (!feof($fp)) {			$buf.= fgets($fp,128);		}		fclose($fp);		//$buf2=getheaders($buf);		//preg_match('@Location: http://(.*)/(.*)\r\n@iU',$buf2,$hit);		if($hit[1]!="" && (!$ignore_redir)) {			$buf=get_request($hit[1],"/".$hit[2]);		}		flush();		return $buf;	}}function name_in_url ($name){	$name = str_replace(' ', '_', $name);	$name = urlencode($name);	return $name;}//holt sich alle Versionenfunction get_history($server, $articleenc, $limit=50, $offset=""){	if($offset=="") 	{ 		$offset = strftime("%Y%m%d%H%M%S");	}		$historyurl = "http://".$server."/w/index.php?title=".$articleenc."&action=history&limit=$limit&offset=$offset";	return get_request($server, $historyurl);}function create_images($was_found){	if($was_found)	{		//$bild = imagecreatefrompng('shared_inc/ok.png');		$hoch = 15;		$breit = 25;		$bild = imagecreate($breit, $hoch);		$hg = imagecolorallocate($bild, 255,255,255);		imagefilledrectangle($bild, 1, 1, $breit, $hoch, $hg);		$font = 5;				$farbe = imagecolorallocate($bild, 0,255,0);		$meldung = "ok";	}	else	{		$hoch = 30;		$breit = 50;		$bild = imagecreate($breit, $hoch);		$hg = imagecolorallocate($bild, 255,255,255);		imagefilledrectangle($bild, 1, 1, $breit, $hoch, $hg);		$font = 5;		//$bild = imagecreatefrompng('shared_inc/no.png');		$farbe = imagecolorallocate($bild, 255, 0,0);		$meldung = "fehlt";	}		imagestring($bild, $font, 5, 5, $meldung, $farbe);	imagepng($bild);	imagedestroy($bild);	}?>